from sqlalchemy.orm import Session
from ..models.vulnerability import Vulnerability

def create_vulnerability(db: Session, *, scan_id: int, vuln_data: dict):
    db_obj = Vulnerability(
        scan_id=scan_id,
        name=vuln_data.get("name"),
        severity=vuln_data.get("severity"),
        cvss_score=vuln_data.get("cvss_score"),
        description=vuln_data.get("description"),
        host=vuln_data.get("host"),
        port=vuln_data.get("port"),
    )
    db.add(db_obj)
    db.commit()
    db.refresh(db_obj)
    return db_obj

def bulk_create_vulnerabilities(db: Session, *, scan_id: int, vulnerabilities_data: list):
    vuln_objects = [
        Vulnerability(
            scan_id=scan_id,
            name=vuln.get("name"),
            severity=vuln.get("severity"),
            cvss_score=vuln.get("cvss_score"),
            description=vuln.get("description"),
            host=vuln.get("host"),
            port=vuln.get("port"),
        ) for vuln in vulnerabilities_data
    ]
    db.bulk_save_objects(vuln_objects)
    db.commit()
